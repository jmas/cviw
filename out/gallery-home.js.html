<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gallery-home.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: gallery-home.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author Alexander Maslakov &lt;jmas.ukraine@gmail.com>
 * @license MIT
 */
require(['./gallery', './utils', './api'], function(Gallery, utils, api) {
  'use strict';

  var REPORT_IMAGE_VIEW_WAIT = 10000;

  /**
   * @param {String} gallerySelector
   * @returns {Gallery}
   */
  function createGallery (gallerySelector) {
    var lastViewImageId = null;
    var reportImageViewTimer = null;
    var galleryContainerEl = document.querySelector(gallerySelector);
    var containerGalleryId = galleryContainerEl.getAttribute('data-gallery-id');
    var containerImageId = galleryContainerEl.getAttribute('data-image-id');

    // create gallery instance
    var gallery = new Gallery({
      el: galleryContainerEl
    });

    /**
     * @override
     */
    gallery.onUpdate = function () {
      var viewImage = this.getViewImage();
      if (viewImage &amp;&amp; lastViewImageId !== viewImage.id) {
        var imageId = viewImage.id;
        var url = '/gallery/'+containerGalleryId+'/image/' + imageId;
        // chanfe url
        utils.updateUrl(viewImage, viewImage.text, url);
        utils.updateDisqus(imageId, viewImage.text, url);
        lastViewImageId = imageId;
        // report about image view
        clearTimeout(reportImageViewTimer);
        if (! viewImage.viewed) {
          reportImageViewTimer = setTimeout(function () {
            api.reportImageView(imageId).then(function () {
              var image = gallery.getImageById(imageId);
              if (image) { 
                image.viewed = true;
                gallery.updateImage(image);
              }
            });
          }, REPORT_IMAGE_VIEW_WAIT);
        }
      }
      // handle favorite button click
      var favoriteButtonEl = galleryContainerEl.querySelector('.js-gallery-favorite-button');
      if (favoriteButtonEl) {
        favoriteButtonEl.addEventListener('click', function (event) {
          event.preventDefault();
          var target = event.target;
          var imageId = target.getAttribute('data-image-id');
          var image = gallery.getImageById(imageId);
          api.toggleImageFavorite(imageId, !image.favorite).then(function () {
            var image = gallery.getImageById(imageId);
            if (image) {
              image.favorite = !image.favorite;
              gallery.updateImage(image);
              if (image.favorite) {
                target.classList.add('active');
              } else {
                target.classList.remove('active');
              }
            }
          });
        });
      }
    };

    // load images
    api.loadGalleryImages(containerGalleryId)
      .then(function (images) {
        var viewIndex = 0;
        gallery.update({
          images: images
        }, true);
        if (containerImageId) {
          viewIndex = gallery.getImageIndexById(containerImageId);
        }
        if (viewIndex) {
          gallery.update({
            viewIndex: viewIndex
          });
        }
      })
      .catch(function () {
        window.replace('/');
      });

    // handle keyboard events
    window.addEventListener('keydown', function (event) {
      switch (event.keyCode) {
        case 37: // left
        // case 38: // up
          event.preventDefault();
          gallery.changeImageViewToPrev();
          break;
        case 39: // right
        // case 40: // down
          event.preventDefault();
          gallery.changeImageViewToNext();
          break;
      }
    }, true);

    return gallery;
  }

  // run
  return createGallery('.js-gallery-container');
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Base.html">Base</a></li><li><a href="Gallery.html">Gallery</a></li></ul><h3>Namespaces</h3><ul><li><a href="api.html">api</a></li><li><a href="const.html">const</a></li><li><a href="utils.html">utils</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun May 15 2016 10:32:48 GMT+0300 (EEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
